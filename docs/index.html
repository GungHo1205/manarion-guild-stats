<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Guild Stats Dashboard</title>
    <style>
      :root {
        --bg-primary: #0a0a0b;
        --bg-secondary: #1a1a1b;
        --bg-tertiary: #2a2a2b;
        --text-primary: #f8f9fa;
        --text-secondary: #b3b3b3;
        --accent: #4a9eff;
        --accent-hover: #3a8eef;
        --border: #3a3a3b;
        --shadow: rgba(0, 0, 0, 0.5);
        --gradient-1: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        --gradient-2: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        --gradient-3: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI",
          Roboto, sans-serif;
        background: var(--bg-primary);
        color: var(--text-primary);
        line-height: 1.6;
        min-height: 100vh;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
      }

      .header {
        text-align: center;
        margin-bottom: 40px;
        padding: 40px 0;
        background: var(--bg-secondary);
        border-radius: 20px;
        border: 1px solid var(--border);
        box-shadow: 0 10px 30px var(--shadow);
      }

      .header h1 {
        font-size: 3rem;
        font-weight: 800;
        background: var(--gradient-1);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin-bottom: 10px;
      }

      .header p {
        color: var(--text-secondary);
        font-size: 1.1rem;
      }

      .stats-overview {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 40px;
      }

      .stat-card {
        background: var(--bg-secondary);
        border: 1px solid var(--border);
        border-radius: 15px;
        padding: 25px;
        text-align: center;
        box-shadow: 0 5px 20px var(--shadow);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
      }

      .stat-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 40px var(--shadow);
      }

      .stat-card h3 {
        font-size: 2.5rem;
        font-weight: 700;
        margin-bottom: 10px;
      }

      .stat-card.total-guilds h3 {
        background: var(--gradient-1);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .stat-card.avg-nexus h3 {
        background: var(--gradient-2);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .stat-card.daily-progress h3 {
        background: linear-gradient(
          135deg,
          #ff9a9e 0%,
          #fecfef 50%,
          #fecfef 100%
        );
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .progress-indicator {
        display: block;
        margin-top: 5px;
        font-size: 0.8rem;
        opacity: 0.8;
      }

      .progress-positive {
        color: #4ade80;
      }

      .progress-negative {
        color: #f87171;
      }

      .progress-neutral {
        color: var(--text-secondary);
      }

      .stat-card p {
        color: var(--text-secondary);
        font-size: 1rem;
      }

      .controls {
        margin-bottom: 30px;
        display: flex;
        gap: 20px;
        align-items: center;
        flex-wrap: wrap;
      }

      .search-box {
        flex: 1;
        max-width: 300px;
        position: relative;
      }

      .search-box input {
        width: 100%;
        padding: 12px 20px 12px 45px;
        border: 1px solid var(--border);
        border-radius: 10px;
        background: var(--bg-secondary);
        color: var(--text-primary);
        font-size: 1rem;
        transition: border-color 0.3s ease;
      }

      .search-box input:focus {
        outline: none;
        border-color: var(--accent);
        box-shadow: 0 0 0 3px rgba(74, 158, 255, 0.1);
      }

      .search-icon {
        position: absolute;
        left: 15px;
        top: 50%;
        transform: translateY(-50%);
        color: var(--text-secondary);
      }

      .last-update {
        color: var(--text-secondary);
        font-size: 0.9rem;
        margin-left: auto;
      }

      .guild-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
        gap: 25px;
      }

      .guild-card {
        background: var(--bg-secondary);
        border: 1px solid var(--border);
        border-radius: 15px;
        padding: 25px;
        box-shadow: 0 5px 20px var(--shadow);
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
      }

      .guild-card::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: var(--gradient-1);
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      .guild-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 20px 50px var(--shadow);
        border-color: var(--accent);
      }

      .guild-card:hover::before {
        opacity: 1;
      }

      .guild-name {
        font-size: 1.3rem;
        font-weight: 600;
        margin-bottom: 20px;
        color: var(--text-primary);
        word-break: break-word;
      }

      .level-info {
        display: flex;
        justify-content: space-between;
        margin-bottom: 15px;
      }

      .level-item {
        text-align: center;
        flex: 1;
      }

      .level-label {
        font-size: 0.85rem;
        color: var(--text-secondary);
        text-transform: uppercase;
        font-weight: 500;
        letter-spacing: 0.5px;
      }

      .level-value {
        font-size: 2rem;
        font-weight: 700;
        margin-top: 5px;
      }

      .nexus-level {
        background: var(--gradient-2);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .daily-change {
        font-size: 0.8rem;
        font-weight: 600;
        margin-top: 3px;
        padding: 2px 6px;
        border-radius: 4px;
        text-align: center;
      }

      .daily-change.positive {
        background: rgba(74, 222, 128, 0.1);
        color: #4ade80;
      }

      .daily-change.negative {
        background: rgba(248, 113, 113, 0.1);
        color: #f87171;
      }

      .daily-change.neutral {
        background: rgba(179, 179, 179, 0.1);
        color: var(--text-secondary);
      }

      .loading {
        text-align: center;
        padding: 60px;
        color: var(--text-secondary);
      }

      .spinner {
        border: 3px solid var(--border);
        border-top: 3px solid var(--accent);
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
        margin: 0 auto 20px;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .error {
        background: #2d1b1b;
        border: 1px solid #5c2d2d;
        color: #ff6b6b;
        padding: 20px;
        border-radius: 10px;
        text-align: center;
        margin: 20px 0;
      }

      @media (max-width: 768px) {
        .header h1 {
          font-size: 2rem;
        }

        .controls {
          flex-direction: column;
          align-items: stretch;
        }

        .search-box {
          max-width: none;
        }

        .guild-grid {
          grid-template-columns: 1fr;
        }
      }

      /* Smooth scroll */
      html {
        scroll-behavior: smooth;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header class="header">
        <h1>Guild Stats Dashboard</h1>
        <p>Real-time guild progression tracking</p>
      </header>

      <div class="stats-overview">
        <div class="stat-card total-guilds">
          <h3 id="totalGuilds">-</h3>
          <p>Total Guilds</p>
        </div>
        <div class="stat-card avg-nexus">
          <h3 id="avgNexus">-</h3>
          <p>Avg Nexus Level</p>
          <small id="avgNexusProgress" class="progress-indicator"></small>
        </div>
        <div class="stat-card avg-study">
          <h3 id="avgStudy">-</h3>
          <p>Avg Study Level</p>
          <small id="avgStudyProgress" class="progress-indicator"></small>
        </div>
        <div class="stat-card daily-progress">
          <h3 id="dailyProgress">-</h3>
          <p>Daily Progress</p>
          <small id="baselineDate" class="progress-indicator"></small>
        </div>
      </div>

      <div class="controls">
        <div class="search-box">
          <svg
            class="search-icon"
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <circle cx="11" cy="11" r="8"></circle>
            <path d="m21 21-4.35-4.35"></path>
          </svg>
          <input type="text" id="searchInput" placeholder="Search guilds..." />
        </div>
        <div class="last-update" id="lastUpdate">Last updated: Loading...</div>
      </div>

      <div id="loading" class="loading">
        <div class="spinner"></div>
        <p>Loading guild data...</p>
      </div>

      <div id="error" class="error" style="display: none">
        <p>Failed to load guild data. Please try again later.</p>
      </div>

      <div id="guildGrid" class="guild-grid" style="display: none"></div>
    </div>

    <script>
      let guildsData = [];
      let filteredData = [];

      async function loadGuildData() {
        try {
          const response = await fetch("./guild-data.json");
          if (!response.ok) throw new Error("Failed to fetch data");

          const data = await response.json();
          guildsData = data.guilds || [];
          filteredData = [...guildsData];

          updateStats();
          updateLastUpdated(data.lastUpdated, data.baselineDate);
          renderGuilds();

          document.getElementById("loading").style.display = "none";
          document.getElementById("guildGrid").style.display = "grid";
        } catch (error) {
          console.error("Error loading guild data:", error);
          document.getElementById("loading").style.display = "none";
          document.getElementById("error").style.display = "block";
        }
      }

      function updateStats() {
        const totalGuilds = guildsData.length;
        const avgNexus =
          guildsData.length > 0
            ? Math.round(
                guildsData.reduce((sum, guild) => sum + guild.NexusLevel, 0) /
                  guildsData.length
              )
            : 0;
        const avgStudy =
          guildsData.length > 0
            ? Math.round(
                guildsData.reduce((sum, guild) => sum + guild.StudyLevel, 0) /
                  guildsData.length
              )
            : 0;

        document.getElementById("totalGuilds").textContent = totalGuilds;
        document.getElementById("avgNexus").textContent = avgNexus;
        document.getElementById("avgStudy").textContent = avgStudy;

        // Calculate average progress if available
        const guildsWithNexusProgress = guildsData.filter(
          (g) => g.NexusProgress !== null && g.NexusProgress !== undefined
        );
        const guildsWithStudyProgress = guildsData.filter(
          (g) => g.StudyProgress !== null && g.StudyProgress !== undefined
        );

        if (guildsWithNexusProgress.length > 0) {
          const avgNexusProgress =
            Math.round(
              (guildsWithNexusProgress.reduce(
                (sum, guild) => sum + guild.NexusProgress,
                0
              ) /
                guildsWithNexusProgress.length) *
                10
            ) / 10;
          document.getElementById("avgNexusProgress").textContent = `${
            avgNexusProgress > 0 ? "+" : ""
          }${avgNexusProgress} today`;
          document.getElementById(
            "avgNexusProgress"
          ).className = `progress-indicator progress-${
            avgNexusProgress > 0
              ? "positive"
              : avgNexusProgress < 0
              ? "negative"
              : "neutral"
          }`;
        } else {
          document.getElementById("avgNexusProgress").textContent =
            "No baseline";
          document.getElementById("avgNexusProgress").className =
            "progress-indicator progress-neutral";
        }

        if (guildsWithStudyProgress.length > 0) {
          const avgStudyProgress =
            Math.round(
              (guildsWithStudyProgress.reduce(
                (sum, guild) => sum + guild.StudyProgress,
                0
              ) /
                guildsWithStudyProgress.length) *
                10
            ) / 10;
          document.getElementById("avgStudyProgress").textContent = `${
            avgStudyProgress > 0 ? "+" : ""
          }${avgStudyProgress} today`;
          document.getElementById(
            "avgStudyProgress"
          ).className = `progress-indicator progress-${
            avgStudyProgress > 0
              ? "positive"
              : avgStudyProgress < 0
              ? "negative"
              : "neutral"
          }`;
        } else {
          document.getElementById("avgStudyProgress").textContent =
            "No baseline";
          document.getElementById("avgStudyProgress").className =
            "progress-indicator progress-neutral";
        }

        // Calculate total daily progress
        const totalNexusProgress = guildsWithNexusProgress.reduce(
          (sum, guild) => sum + guild.NexusProgress,
          0
        );
        const totalStudyProgress = guildsWithStudyProgress.reduce(
          (sum, guild) => sum + guild.StudyProgress,
          0
        );
        const totalProgress = totalNexusProgress + totalStudyProgress;

        if (
          guildsWithNexusProgress.length > 0 ||
          guildsWithStudyProgress.length > 0
        ) {
          document.getElementById(
            "dailyProgress"
          ).textContent = `+${totalProgress}`;
        } else {
          document.getElementById("dailyProgress").textContent = "-";
        }
      }

      function updateLastUpdated(timestamp, baselineDate) {
        if (timestamp) {
          const date = new Date(timestamp);
          const options = {
            year: "numeric",
            month: "short",
            day: "numeric",
            hour: "2-digit",
            minute: "2-digit",
            timeZoneName: "short",
          };
          document.getElementById(
            "lastUpdate"
          ).textContent = `Last updated: ${date.toLocaleDateString(
            "en-US",
            options
          )}`;
        }

        if (baselineDate) {
          document.getElementById(
            "baselineDate"
          ).textContent = `Baseline: ${baselineDate}`;
          document.getElementById("baselineDate").className =
            "progress-indicator progress-neutral";
        } else {
          document.getElementById("baselineDate").textContent =
            "No baseline yet";
          document.getElementById("baselineDate").className =
            "progress-indicator progress-neutral";
        }
      }

      function renderGuilds() {
        const grid = document.getElementById("guildGrid");

        if (filteredData.length === 0) {
          grid.innerHTML =
            '<div class="error"><p>No guilds found matching your search.</p></div>';
          return;
        }

        const guildCards = filteredData
          .map(
            (guild) => `
                <div class="guild-card">
                    <div class="guild-name">${
                      guild.GuildName || "Unknown Guild"
                    }</div>
                    <div class="level-info">
                        <div class="level-item">
                            <div class="level-label">Nexus Level</div>
                            <div class="level-value nexus-level">${
                              guild.NexusLevel || 0
                            }</div>
                            ${
                              guild.NexusProgress !== null &&
                              guild.NexusProgress !== undefined
                                ? `<div class="daily-change ${
                                    guild.NexusProgress > 0
                                      ? "positive"
                                      : guild.NexusProgress < 0
                                      ? "negative"
                                      : "neutral"
                                  }">${guild.NexusProgress > 0 ? "+" : ""}${
                                    guild.NexusProgress
                                  }</div>`
                                : '<div class="daily-change neutral">-</div>'
                            }
                        </div>
                        <div class="level-item">
                            <div class="level-label">Study Level</div>
                            <div class="level-value study-level">${
                              guild.StudyLevel || 0
                            }</div>
                            ${
                              guild.StudyProgress !== null &&
                              guild.StudyProgress !== undefined
                                ? `<div class="daily-change ${
                                    guild.StudyProgress > 0
                                      ? "positive"
                                      : guild.StudyProgress < 0
                                      ? "negative"
                                      : "neutral"
                                  }">${guild.StudyProgress > 0 ? "+" : ""}${
                                    guild.StudyProgress
                                  }</div>`
                                : '<div class="daily-change neutral">-</div>'
                            }
                        </div>
                    </div>
                </div>
            `
          )
          .join("");

        grid.innerHTML = guildCards;
      }

      function filterGuilds() {
        const searchTerm = document
          .getElementById("searchInput")
          .value.toLowerCase();
        filteredData = guildsData.filter((guild) =>
          (guild.GuildName || "").toLowerCase().includes(searchTerm)
        );
        renderGuilds();
      }

      // Event listeners
      document
        .getElementById("searchInput")
        .addEventListener("input", filterGuilds);

      // Auto-refresh every 5 minutes
      setInterval(loadGuildData, 5 * 60 * 1000);

      // Initial load
      loadGuildData();
    </script>
  </body>
</html>
